<!-- Main container for the game buzzer interface -->
<div class="game-buzzer-container">

  <!-- Player info card: Shown only if there is an active game session -->
  @if (gameSessionObs | async; as gameSession) {
    <mat-card class="player-info-card">
      <mat-card-content class="player-info-content">
        <!-- Display the current player's name -->
        <div class="player-name">{{ gameStateService.getCurrentPlayer()?.name }}</div>
        <!-- Display the name of the team to which the current player belongs -->
        <div class="player-team">{{ gameStateService.getCurrentPlayerTeam()?.teamName }}</div>
      </mat-card-content>
    </mat-card>
  }

  <!-- Buzzer card: Allows players to buzz in during a game -->
  <mat-card class="game-buzzer">
    <mat-card-title>
      <!-- Display the current round number -->
      Buzz in for Round {{ gameSession.currentMatch.currentRound.roundNumber }}
    </mat-card-title>
    <mat-card-content>
      <!-- Active buzz info: Shown if there's a current buzz -->
      @if (gameSession.currentMatch.currentRound.currentBuzz) {
        <div class="active-buzz-info">
          <!-- Display the name of the player and team who have buzzed in -->
          <p>{{ gameStateService.getPlayerNameById(gameSession.currentMatch.currentRound.currentBuzz.playerId) }} (
            {{ gameStateService.getTeamNameById(gameSession.currentMatch.currentRound.currentBuzz.teamId) }})
            has buzzed in
          </p>
        </div>
      }

      <!-- Buzz button: Allows players to buzz in, visibility and state depend on round conditions -->
      <div class="buzz-button-container">
        @if (gameSession.currentMatch.currentRound.roundState === RoundState.AWAITING_BUZZ ||
          gameSession.currentMatch.currentRound.roundState === RoundState.PROCTOR_READING) {
          <button
            mat-raised-button
            id="buzz-button"
            (click)="gameStateService.sendPlayerIncomingBuzz()"
            [disabled]="gameStateService.hasCurrentPlayerTeamBuzzed()"
            class="buzz-button">
            <!-- Display appropriate text on the buzz button -->
            {{ getBuzzButtonText() }}
          </button>
        }
      </div>

      <!-- Timer Display -->
      @if (gameSession.currentMatch.currentRound.roundState === RoundState.AWAITING_BUZZ && getTossupTimerDisplay()) {
        <div class="timer-display">
          <p>Time remaining: {{ getTossupTimerDisplay() }}s</p>
        </div>
      }

      <!-- Bonus Display - Simple view for players -->
      @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_READING_PREAMBLE ||
        gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_READING_PART ||
        gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_AWAITING_ANSWER ||
        gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_COMPLETED) {
        <div
          class="bonus-section">
          <div class="bonus-info">
            <h3>Bonus Round in Progress</h3>
            <p><strong>{{ getBonusEligibleTeamName() }}</strong> is answering bonus questions</p>
            <div class="bonus-score">
              Current Bonus Score: {{ gameStateService.getCurrentRoundBonusPoints() }} / 30 points
            </div>
            <!-- Timer Display during answer phase -->
            @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_AWAITING_ANSWER && getBonusTimerDisplay()) {
              <div
                class="timer-display">
                <p class="bonus-timer">‚è± Time remaining: {{ getBonusTimerDisplay() }}s</p>
              </div>
            }
            <!-- Status message based on phase -->
            <div class="bonus-status">
              @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_READING_PREAMBLE) {
                <p>
                  Proctor is reading the preamble...
                </p>
              }
              @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_READING_PART) {
                <p>
                  Proctor is reading Part {{ gameSession.currentMatch.currentRound.currentBonusPartIndex + 1 }}...
                </p>
              }
              @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_AWAITING_ANSWER) {
                <p>
                  {{ getBonusEligibleTeamName() }} is answering Part {{ gameSession.currentMatch.currentRound.currentBonusPartIndex + 1 }}
                </p>
              }
              @if (gameSession.currentMatch.currentRound.roundState === RoundState.BONUS_COMPLETED) {
                <p>
                  Bonus completed!
                </p>
              }
            </div>
          </div>
        </div>
      }

      <!-- Round completed. Show question and answer -->
      @if (gameSession.currentMatch.currentRound.roundState === 'COMPLETED') {
        <div class="round-completed-info">
          <h3>Round Completed</h3>
          <p><strong>Question:</strong> <span [innerHTML]="gameSession.currentMatch.currentRound.question"></span></p>
          <p><strong>Answer:</strong> <span [innerHTML]="gameSession.currentMatch.currentRound.answer"></span></p>
        </div>
      }


      <!-- Team list component: Displays a list of teams with their respective scores and buzz statuses -->
      <app-team-list [teams]="gameSession.teamList"
        [currentBuzz]="gameSession.currentMatch.currentRound.currentBuzz"
        [currentRound]="gameSession.currentMatch.currentRound"
        [previousRoundList]="gameSession.currentMatch.previousRounds">
      </app-team-list>
    </mat-card-content>
  </mat-card>
</div>
